<!DOCTYPE html>
<html lang="ja">
  <link rel="stylesheet" href="css/style.css">


<head>
  <meta charset="utf-8" />
  <title>Chatã‚¢ãƒ—ãƒª</title>
</head>

<body>
  <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

  <div>
    <!-- æ¸¬å®šæ—¥æ™‚ -->
    æ¸¬å®šæ™‚é–“
    <input type="date" id="date" value="2020-05-18">
  </div>

  <div>
    <!-- æ¸¬å®šæ™‚é–“ -->
    æ¸¬å®šæ™‚é–“
    <input type="time" id="time" value="">
  </div>

  <div>
    <!-- åç¸®æœŸè¡€åœ§ -->
    åç¸®æœŸè¡€åœ§
    <input type="number" id="sbp">
  </div>

  <div>
    <!-- æ‹¡å¼µæœŸè¡€åœ§ -->
    æ‹¡å¼µæœŸè¡€åœ§
    <input type="number" id="dbp">
  </div>ã€€

  <div>
    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <button id="send">é€ä¿¡</button>
  </div>

  <div>
    <!-- ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ç®‡æ‰€ -->
    <div id="output"></div>
  </div>ã€€ã€€ã€€
  <div>
    <!-- è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
    <button id="display">è¡¨ç¤º</button>
  </div>ã€€ã€€ã€€ 

  <div>
    <!-- ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´æ‰€ -->
  <canvas id="myLineChart"></canvas>
  </div>

  <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- JQuery -->
  <!-- chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
  <!-- chart.js -->

  <!--** ä»¥ä¸‹Firebase **-->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!-- 6.6.1ã«è©²å½“ã™ã‚‹ç®‡æ‰€ã¯firebaseã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã®ã§æ›´æ–°ã•ã‚Œã‚‹ãŸã³ã«éšæ™‚å¤‰ã‚ã‚Šã¾ã™ğŸ¤— -->
  <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

  <script>
    // Your web app's Firebase configuration

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);


    //firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼ˆä¿å­˜ã•ã›ã‚‹å ´æ‰€ï¼‰ã‚’ä½¿ã„ã¾ã™ã‚ˆ
    const newPostRef = firebase.database().ref();

    // ã“ã“ã‹ã‚‰ä¸‹ã«jqueryã®å‡¦ç†ã‚’æ›¸ã„ã¦ç·´ç¿’ã—ã¾ã™

    // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $("#send").on("click", function () {

      newPostRef.push({
        date:$("#date").val(),
        time:$("#time").val(),
        sbp:$("#sbp").val(),
        dbp:$("#dbp").val()
      })
       $("#date").val("");
       $("#time").val(""),
       $("#sbp").val("");
       $("#dbp").val("");
    });

    let vdate;
    let vtime;
    let vsbp;
    let vdbp;

    (function () {
        newPostRef.on("child_added", function (data) {
        let v = data.val();
        let k = data.key;
        vdate = `${v.date}`; 
        vtime = `${v.time}`; 
        vsbp = Number(`${v.sbp}`);
        vdbp = Number(`${v.dbp}`);
        console.log(vdate, vtime, vsbp, vdbp);    
        let str = '<div class="flex-container"><dl><dt>'+'æ—¥æ™‚ã€€'+vdate+'</br>'+'æ™‚é–“ã€€'+vtime+'</dt><dd>'+'åç¸®æœŸè¡€åœ§'+vsbp+'</br>'+'æ‹¡å¼µæœŸè¡€åœ§'+vdbp+'</dd></dl><button id="clear" title=${key}>æ¶ˆå»</button></div>';
        $("#output").prepend(str);
        })
        $("#dbp").on("keydown", function (e) {
        // console.log(e, 'eventãƒ‡ãƒ¼ã‚¿ã®å›ºã¾ã‚Š')
        if(e.keyCode === 13){
            newPostRef.push({
            date:$("#date").val(), 
            time:$("#time").val(),  
            sbp:$("#sbp").val(),
            dbp: $("#dbp").val()
        })
        $("#date").val("");
        $("#time").val("");
        $("#sbp").val("");
        $("#dbp").val("");
        }
        })
    }());

    
  

    // $("#clear").on("child_removed",function(){
    //   let key = this.title;
    //   newPostRef.remove(key);
    // });
    
    

    // ã€€ã‚°ãƒ©ãƒ•ã«ã™ã‚‹ 
    $("#display").on("click", function () {
        console.log(vdate, vtime, vsbp, vdbp);

    var ctx = document.getElementById("myLineChart");
    var myLineChart = new Chart(ctx, {
      // ã‚¿ã‚¤ãƒ—
        type: 'line',
      // æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã®ä½œæˆï¼ˆãƒ©ãƒ™ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼‰
        data: {
          labels: vdate,
          datasets: [
                      {
                        label: 'åç¸®æœŸè¡€åœ§',
                        data: vsbp,
                        borderColor: "rgba(255,0,0,1)",
                        backgroundColor: "rgba(0,0,0,0)"
                      },
                      {
                        label: 'æ‹¡å¼µæœŸè¡€åœ§',
                        data: vdbp,
                        borderColor: "rgba(0,0,255,1)",
                        backgroundColor: "rgba(0,0,0,0)"
                      }
                   ],
           },

      // ã‚¿ã‚¤ãƒˆãƒ«
        options: {
             title: {
              display: true,
              text: 'è¡€åœ§ã®æ¨ç§»'
              },
        scales: {
               yAxes: [{
                ticks: {
                suggestedMax: 200,
                suggestedMin: 50,
                stepSize: 10,
                callback: function(value, index, values){
                  return  value +  'mmHg'
                ã€€}
                }
               }]
               },
        }

    });
  });
  </script>
</body>

</html>


